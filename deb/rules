#!/usr/bin/make -f

%:
	dh $@ --with python2,python3 --buildsystem=pybuild

override_dh_installman:
	make doc/pagekite.1
	dh_installman doc/*.?

# After the basic Python installation, add files for /etc/
override_dh_auto_install:
	python setup.py install --root=$(CURDIR)/debian/python-pagekite --install-layout=deb
	python3 setup.py install --root=$(CURDIR)/debian/python3-pagekite --install-layout=deb
	rm -f $(CURDIR)/debian/python*-pagekite/usr/bin/pagekite
	mkdir -m 755 -p $(CURDIR)/debian/pagekite/etc/pagekite.d/
	mkdir -m 755 -p $(CURDIR)/debian/pagekite/usr/bin/
	install -m 644 $(CURDIR)/etc/pagekite.d/[23456789]* \
                        $(CURDIR)/debian/pagekite/etc/pagekite.d/
	install -m 600 $(CURDIR)/etc/pagekite.d/10* \
                        $(CURDIR)/debian/pagekite/etc/pagekite.d/
	install -m 755 $(CURDIR)/scripts/pagekite-deb.sh \
                        $(CURDIR)/debian/pagekite/usr/bin/pagekite

override_dh_builddeb:
	dh_builddeb -- -Zgzip
